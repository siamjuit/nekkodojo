generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id         String  @id
  email      String  @unique
  name       String?
  profileUrl String?

  firstName String?
  lastName  String?
  bio       String?

  isOnboarded Boolean? @default(false)

  noOfQuestionsSolved Int?
  beltRank            BeltType @default(white_belt)

  discussions Discussions[]
  comments    Comments[]

  likes     Likes[]
  bookmarks Bookmark[]

  role           String  @default("user")
  isShadowBanned Boolean @default(false)
  isBanned       Boolean @default(false)

  createdAt DateTime? @default(now())
  updatedAt DateTime? @updatedAt
  reports   Report[]
}

model Discussions {
  id          String  @id @default(uuid())
  title       String
  description String
  tag         TagType @default(Discussion)

  authorId String
  author   User   @relation(fields: [authorId], references: [id])

  comments    Comments[]
  attachments Attachment[]

  likes        Likes[]
  likeCount    Int     @default(0)
  disLikeCount Int     @default(0)

  bookmarks Bookmark[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  reports   Report[]

  @@index([tag])
}

model Comments {
  id          String @id @default(uuid())
  description String

  authorId String
  author   User   @relation(fields: [authorId], references: [id])

  discussionId String
  discussion   Discussions @relation(fields: [discussionId], references: [id], onDelete: Cascade)

  parentId String?
  parent   Comments?  @relation("CommentChildren", fields: [parentId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  replies  Comments[] @relation("CommentChildren")

  attachments Attachment?

  likes        Likes[]
  likeCount    Int     @default(0)
  dislikeCount Int     @default(0)

  bookmarks Bookmark[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  reports   Report[]
}

model Attachment {
  id String @id

  postUrl String
  type    AttachmentType

  discussionId String?
  discussion   Discussions? @relation(fields: [discussionId], references: [id], onDelete: Cascade)

  commentId String?   @unique
  comment   Comments? @relation(fields: [commentId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Likes {
  id String @id @default(uuid())

  type LikeType

  discussionId String?
  discussion   Discussions? @relation(fields: [discussionId], references: [id], onDelete: Cascade)

  commentId String?
  comment   Comments? @relation(fields: [commentId], references: [id], onDelete: Cascade)

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, discussionId])
  @@unique([userId, commentId])
}

model Bookmark {
  id String @id @default(uuid())

  discussionId String?
  discussion   Discussions? @relation(fields: [discussionId], references: [id], onDelete: Cascade)

  commentId String?
  comment   Comments? @relation(fields: [commentId], references: [id], onDelete: Cascade)

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, discussionId])
  @@unique([userId, commentId])
}

model Report {
  id String @id @default(uuid())

  reason String

  reporterId String
  reporter   User   @relation(fields: [reporterId], references: [id])

  discussionId String?
  discussion   Discussions? @relation(fields: [discussionId], references: [id])

  commentId String?
  comment   Comments? @relation(fields: [commentId], references: [id])

  status    ReportStatusType @default(PENDING)
  createdAt DateTime         @default(now())
}

enum AttachmentType {
  image
  video
  gif
}

enum LikeType {
  like
  dislike
}

enum TagType {
  Discussion
  Senseis_Wisdom
  Guidance_Needed
  Kata
  Ronins_Path
  Dojo_Life
  Showcase
  Dynamic_Programming
  Graphs_n_Trees
  Arrays_n_Strings
  Recursion
  Bit_Manipulation
  System_Design
  Math_n_Geometry
  TypeScript_JavaScript
  Python
  CPP_n_C
  Java
  Rust
  Gate
  SQL
  NoSQL
  Frontend
  Backend
  Job
  Placement
}

enum BeltType {
  white_belt
  yellow_belt
  orange_belt
  green_belt
  blue_belt
  purple_belt
  brown_belt
  black_belt
}

enum ReportStatusType {
  PENDING
  REVIEWED
  DISMISSED
}
